#!/usr/bin/env bash

readonly API_URL='https://disease.sh/v3/covid-19'

# deixando claro que data Ã© um array associativo
declare -A data

json2array() {
  local jsonData="$1"

  # verificando se Ã© um JSON vÃ¡lido
  jq empty <<<"$jsonData" 2>/dev/null || return 1

  while IFS== read -r key value; do
    data[$key]="$value"
  done < <(jq -r '. | to_entries | .[] | .key + "=" + (.value|tostring)' <<<"$jsonData")
}

main() {
  local json
  
  # primeiro dados globais:
  json="$(curl --silent "${API_URL}/all")"

  if ! json2array "$json"; then
    echo "ERRO: falha ao obter os dados de $API_URL" >&2
    exit 1
  fi

  echo -n "
------Dados GlobaisğŸŒ------
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â¤NÃºmero de casos: ${data[cases]}
â”‚â¤NÃºmero de mortes: ${data[deaths]}
â”‚â¤Pacientes curados: ${data[recovered]}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"
}

main "$@"
